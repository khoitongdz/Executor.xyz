<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>game test</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    body { margin: 0; display: flex; justify-content: center; align-items: center; background: #222; }
    canvas { border: 2px solid #444; }
  </style>
</head>
<body>
<script>
let playerX, playerY;
let obstacles = [];
let score = 0;
let gameOver = false;
let lanes = [150, 250, 350];
let speed = 5;
let bgY = 0;

function setup() {
  createCanvas(500, 400);
  playerX = lanes[1];
  playerY = 320;
}

function draw() {
  // Draw animated background
  background(50, 50, 80);
  for (let y = bgY; y < height; y += 20) {
    stroke(150);
    line(0, y, width, y);
  }
  bgY = (bgY + 1) % 20;

  // Draw rails
  for (let i = 0; i < 3; i++) {
    stroke(100);
    strokeWeight(4);
    line(lanes[i], 0, lanes[i], height);
  }

  // Move player based on mouse
  if (!gameOver) {
    let targetLane = lanes[0];
    if (mouseX < width / 3) targetLane = lanes[0];
    else if (mouseX < 2 * width / 3) targetLane = lanes[1];
    else targetLane = lanes[2];
    playerX = lerp(playerX, targetLane, 0.1); // Smooth movement
  }

  // Draw player (simple train)
  fill(0, 100, 200);
  rect(playerX - 20, playerY - 30, 40, 60, 10);
  fill(0);
  ellipse(playerX - 15, playerY + 20, 15, 15);
  ellipse(playerX + 15, playerY + 20, 15, 15);

  // Update and draw obstacles
  if (!gameOver) {
    if (frameCount % 60 === 0) {
      let lane = lanes[floor(random(3))];
      obstacles.push({ x: lane, y: -30 });
    }

    for (let i = obstacles.length - 1; i >= 0; i--) {
      obstacles[i].y += speed;
      fill(139, 69, 19); // Wooden crate color
      rect(obstacles[i].x - 20, obstacles[i].y - 20, 40, 40, 5);
      fill(100);
      rect(obstacles[i].x - 15, obstacles[i].y - 15, 30, 30, 5);

      // Check collision
      if (dist(playerX, playerY, obstacles[i].x, obstacles[i].y) < 40) {
        gameOver = true;
      }

      // Remove obstacles off screen
      if (obstacles[i].y > height + 30) {
        obstacles.splice(i, 1);
      }
    }

    // Increase difficulty
    speed = 5 + score / 1000;
    score += 1;
  }

  // Display score
  fill(255);
  textSize(20);
  textAlign(LEFT);
  text("Score: " + floor(score / 10), 10, 30);

  // Game over screen
  if (gameOver) {
    fill(255, 0, 0, 200);
    rect(0, 0, width, height);
    fill(255);
    textSize(40);
    textAlign(CENTER);
    text("Game Over!", width / 2, height / 2);
    textSize(24);
    text("Score: " + floor(score / 10), width / 2, height / 2 + 50);
    noLoop();
  }
}

function mousePressed() {
  if (gameOver) {
    // Reset game
    obstacles = [];
    score = 0;
    speed = 5;
    playerX = lanes[1];
    gameOver = false;
    loop();
  }
}
</script>
</body>
</html>
