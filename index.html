<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Bắn Tàu Vũ Trụ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: radial-gradient(circle, #1a1a3a, #000);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        canvas {
            border: 3px solid #00ff00;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
        }
        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #00ff00;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 15px #00ff00;
        }
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff3333;
            font-size: 60px;
            font-weight: bold;
            text-shadow: 0 0 20px #ff3333;
            display: none;
            text-align: center;
        }
        #startScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 3rem;
            border-radius: 20px;
            color: #fff;
            text-align: center;
            max-width: 600px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.4);
            border: 2px solid #00ff00;
        }
        #startScreen h1 {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 15px #00ff00;
        }
        #startScreen p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        #startButton {
            padding: 1.2rem 3rem;
            font-size: 1.5rem;
            background: linear-gradient(45deg, #00ff00, #00cc00);
            border: none;
            border-radius: 12px;
            color: #000;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
        }
        #startButton:hover {
            transform: scale(1.15);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.8);
        }
    </style>
</head>
<body>
    <div id="score">Điểm: 0</div>
    <div id="gameOver">Kết Thúc!<br>Nhấn R để Chơi Lại</div>
    <div id="startScreen">
        <h1>Game fifai pc</h1>
        <p>Sử dụng <strong>MŨI TÊN TRÁI</strong> và <strong>MŨI TÊN PHẢI</strong> để di chuyển tàu vũ trụ.<br>
           Nhấn <strong>PHÍM CÁCH</strong> để bắn đạn.<br>
           Tiêu diệt kẻ thù (hình vuông đỏ) để ghi điểm, tránh va chạm với chúng!<br>
           Khi kết thúc, nhấn <strong>R</strong> để chơi lại.</p>
        <button id="startButton">Bắt Đầu Chơi</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        let player, bullets, enemies, score, gameOver, gameStarted, particles;

        function setup() {
            createCanvas(800, 600);
            resetGame();
            gameStarted = false;
            document.getElementById('startScreen').style.display = 'block';
            noLoop();

            gsap.from('#startScreen', { opacity: 0, y: 50, duration: 1, ease: 'power2.out' });
            gsap.from('#startButton', { scale: 0.8, opacity: 0, duration: 1, delay: 0.5, ease: 'elastic.out(1, 0.5)' });

            document.getElementById('startButton').addEventListener('click', () => {
                gsap.to('#startScreen', {
                    opacity: 0,
                    y: -50,
                    duration: 0.5,
                    ease: 'power2.in',
                    onComplete: () => {
                        document.getElementById('startScreen').style.display = 'none';
                        gameStarted = true;
                        loop();
                    }
                });
            });
        }

        function resetGame() {
            player = {
                x: width / 2,
                y: height - 50,
                size: 30,
                speed: 6
            };
            bullets = [];
            enemies = [];
            particles = [];
            score = 0;
            gameOver = false;
            document.getElementById('score').textContent = `Điểm: ${score}`;
            document.getElementById('gameOver').style.display = 'none';
        }

        function draw() {
            background(0, 0, 20);

            // Draw starry background
            for (let i = 0; i < 50; i++) {
                fill(255, random(100, 255));
                noStroke();
                ellipse(random(width), random(height), random(1, 3));
            }

            if (gameStarted && !gameOver) {
                // Player movement
                if (keyIsDown(LEFT_ARROW)) player.x -= player.speed;
                if (keyIsDown(RIGHT_ARROW)) player.x += player.speed;
                player.x = constrain(player.x, player.size / 2, width - player.size / 2);

                // Draw player with glow and thruster effect
                fill(0, 255, 0);
                stroke(0, 255, 0, 150);
                strokeWeight(10);
                triangle(
                    player.x, player.y - player.size / 2,
                    player.x - player.size / 2, player.y + player.size / 2,
                    player.x + player.size / 2, player.y + player.size / 2
                );
                strokeWeight(1);
                stroke(0);
                // Thruster
                fill(255, 165, 0, 150);
                triangle(
                    player.x, player.y + player.size / 2,
                    player.x - player.size / 4, player.y + player.size,
                    player.x + player.size / 4, player.y + player.size
                );

                // Shoot bullets
                if (keyIsDown(32) && frameCount % 6 === 0) {
                    bullets.push({ x: player.x, y: player.y - player.size, speed: -15 });
                }

                // Draw and move bullets with trail
                for (let i = bullets.length - 1; i >= 0; i--) {
                    let bullet = bullets[i];
                    bullet.y += bullet.speed;
                    if (bullet.y < -10) {
                        bullets.splice(i, 1);
                        continue;
                    }
                    fill(255, 255, 0);
                    stroke(255, 255, 0, 150);
                    strokeWeight(6);
                    ellipse(bullet.x, bullet.y, 6, 12);
                    strokeWeight(1);
                    stroke(0);
                }

                // Spawn enemies
                if (frameCount % 15 === 0) {
                    enemies.push({
                        x: random(width),
                        y: -20,
                        size: 25,
                        speed: 5
                    });
                }

                // Draw and move enemies with pulsing effect
                for (let i = enemies.length - 1; i >= 0; i--) {
                    let enemy = enemies[i];
                    enemy.y += enemy.speed;
                    if (enemy.y > height + enemy.size) {
                        enemies.splice(i, 1);
                        continue;
                    }
                    let pulse = sin(frameCount * 0.15 + i) * 5 + enemy.size;
                    fill(255, 0, 0);
                    stroke(255, 0, 0, 150);
                    strokeWeight(6);
                    rect(enemy.x - pulse / 2, enemy.y - pulse / 2, pulse, pulse, 5);
                    strokeWeight(1);
                    stroke(0);

                    // Check collision with player
                    if (dist(enemy.x, enemy.y, player.x, player.y) < (pulse + player.size) / 2) {
                        gameOver = true;
                        document.getElementById('gameOver').style.display = 'block';
                        gsap.fromTo('#gameOver', { scale: 0.5, opacity: 0 }, { scale: 1, opacity: 1, duration: 0.7, ease: 'elastic.out(1, 0.5)' });
                        noLoop();
                    }

                    // Check collision with bullets
                    for (let j = bullets.length - 1; j >= 0; j--) {
                        let bullet = bullets[j];
                        if (dist(enemy.x, enemy.y, bullet.x, bullet.y) < pulse / 2) {
                            enemies.splice(i, 1);
                            bullets.splice(j, 1);
                            score += 10;
                            document.getElementById('score').textContent = `Điểm: ${score}`;
                            // Add particles for explosion
                            for (let k = 0; k < 20; k++) {
                                particles.push({
                                    x: enemy.x,
                                    y: enemy.y,
                                    vx: random(-3, 3),
                                    vy: random(-3, 3),
                                    size: random(2, 6),
                                    alpha: 255
                                });
                            }
                            break;
                        }
                    }
                }

                // Draw particles for explosion
                for (let i = particles.length - 1; i >= 0; i--) {
                    let particle = particles[i];
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.alpha -= 5;
                    if (particle.alpha <= 0) {
                        particles.splice(i, 1);
                        continue;
                    }
                    fill(255, 165, 0, particle.alpha);
                    noStroke();
                    ellipse(particle.x, particle.y, particle.size);
                }
            }
        }

        function keyPressed() {
            if (key === 'r' && gameOver) {
                gsap.to('#gameOver', {
                    opacity: 0,
                    scale: 0.5,
                    duration: 0.5,
                    ease: 'power2.in',
                    onComplete: () => {
                        resetGame();
                        loop();
                    }
                });
            }
        }
    </script>
</body>
</html>
